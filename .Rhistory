host = "c1-ctmr-epi.ki.se", port= 22)
library(RMySQL)
library(RPostgres)
con_dat <- dbConnect(Postgres(),
user = "nigus",
password = "SdacLacToWlo",
dbname = "042_pcos_romina",
host = "c1-ctmr-epi.ki.se", port= 22)
library(PredictABEL)
library(PredictABEL)
library(MASS)
library(pROC)
library(boot)
library(tidyverse)
library(table1)
library(haven)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP, family= binomial, data = new_data)
setwd("C:/Users/User/Desktop/Nigus")
library(haven)
dat_cs <- read_sav("thesis_data_NB.sav")
new_data <- dat_cs %>%
dplyr::select(participant_id, age, gravidity, parity, abortion, IUFD, Preterm_d, instrumental_d, C_S, ANC, mode_delivery_last, DM, PROM, PTL, APH, HDP, mode_delivery,medical_illness,number_ANC_cat)
## outcome
new_data <- mutate(new_data, outcome= ifelse(as.character(new_data$mode_delivery) == "5", 1, 0))
##Advanced age
new_data<-mutate(new_data, Advanced_age=ifelse(age>34,1,0))
##history of any medical illness
new_data$medical_illness<-ifelse(as.character(new_data$medical_illness)=="1", 1, 0)
##ANC visit
new_data$number_ANC_cat<-ifelse(as.character(new_data$number_ANC_cat)=="1", 1, 0)
## Abortion
new_data$abortion <-ifelse(as.character(new_data$abortion) == "1", 1, 0)
## IUFD
new_data$IUFD <-ifelse(as.character(new_data$IUFD) == "1", 1, 0)
## PRETERM
new_data$Preterm_d <-ifelse(as.character(new_data$Preterm_d) == "1", 1, 0)
## inst delivery
new_data$instrumental_d <-ifelse(as.character(new_data$instrumental_d) == "1", 1, 0)
## CS
new_data$C_S <-ifelse(as.character(new_data$C_S) == "1", 1, 0)
## ANC
new_data$ANC <-ifelse(as.character(new_data$ANC) == "2", 1, 0)
## previous mode del
new_data$mode_delivery_last <-ifelse(as.character(new_data$mode_delivery_last) == "2", 1, 0)
## PROM
new_data$PROM <-ifelse(as.character(new_data$PROM) == "1", 1, 0)
## HDP
new_data$HDP <-ifelse(as.character(new_data$HDP) == "1", 1, 0)
## Parity
new_data <- mutate(new_data, parity_cat= ifelse(parity > 4, 1,0))
table1(~ as.factor(Advanced_age) + as.factor(medical_illness) + as.factor(number_ANC_cat) + as.factor(abortion) + as.factor(IUFD) + as.factor(Preterm_d) + as.factor(C_S) + as.factor(ANC) + as.factor(mode_delivery_last) + as.factor(PROM) + as.factor(HDP) + as.factor(parity_cat) | as.factor(outcome), data= new_data)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP, family= binomial, data = new_data)
summary(full_fit)
## model reduction
stepAIC(full_fit)
## OR for full model
OR_full <- exp(cbind(OR= coef(full_fit), confint(full_fit)))
round(OR_full, digits = 3)
red_model <- full_fit <- glm(outcome~  HDP + mode_delivery_last, family= binomial, data = new_data)
## ORs and CIs
OR_CI <- exp(cbind(OR= coef(red_model), confint(red_model)))
round(OR_CI, digits = 3)
predicted_probabilities <- predict(red_model, type = "response")
calibration_data <- data.frame(Outcome = new_data$outcome, Predicted_Risks = predicted_probabilities)
predRisk <- predRisk(red_model)
plotCalibration(calibration_data, 1, predRisk, 10,plottitle = "Calibration_of_the_model")
predsred = predict(red_model,type="response")
plot.roc(new_data$outcome, predsred,print.auc=TRUE)
new_data$HDP_rs<-as.numeric(new_data$HDP)
new_data$mode_delivery_last_rs<-as.numeric(new_data$mode_delivery_last)
new_data$Risk_score<-(1*new_data$HDP_rs)+(3*new_data$mode_delivery_last_rs)
cor.test(new_data$outcome,new_data$Risk_score)
table(new_data$Risk_score)
risk<-glm(new_data$outcome~new_data$Risk_score,family = binomial)
predsrisk = predict(risk,type="response")
plot.roc(new_data$outcome, predsrisk,print.auc=TRUE)
install.packages("dcurves")
install.packages("rmda")
Dcred<-decision_curve(outcome~  HDP + mode_delivery_last, family= binomial, data = new_data,thresholds = seq(0, 1, by = .01),confidence.intervals = 0.95)
library(dcurves)
library(rmda)
Dcred<-decision_curve(outcome~  HDP + mode_delivery_last, family= binomial, data = new_data,thresholds = seq(0, 1, by = .01),confidence.intervals = 0.95)
# Define the colors for each line
line.colors <- c("blue", "green","red")
plot_decision_curve(x=Dcred, curve.names=c("Model", "Intervention for all", "Intervention for none"), cost.benefit.axis = TRUE,col = line.colors)
table1(~ Preterm_d + PROM + HDP, data = new_data)
table1(~ as.factor(Preterm_d) + as.factor(PROM) + as.factor(HDP), data = new_data)
View(dat_cs)
table1(~ as.factor(NICU) + as.factor(resuscitat) + as.factor(cong_malf) + as.factor(meconium) + as.factor(dead_afterdelivery) + as.factor(stillborn) + apgar + weight, data = new_data)
table1(~ as.factor(NICU) + as.factor(resuscitat) + as.factor(cong_malf) + as.factor(meconium) + as.factor(dead_afterdelivery) + as.factor(stillborn) + apgar + weight, data = dat_cs)
table1(new_data$mode_delivery)
table(new_data$mode_delivery)
View(new_data)
dat_cs <- read_sav("thesis_data_NB.sav")
View(dat_cs)
dat_cs <- dat_cs[-310, ]
new_data <- dat_cs %>%
dplyr::select(participant_id, age, gravidity, parity, abortion, IUFD, Preterm_d, instrumental_d, C_S, ANC, mode_delivery_last, DM, PROM, PTL, APH, HDP, mode_delivery,medical_illness,number_ANC_cat)
## outcome
new_data <- mutate(new_data, outcome= ifelse(as.character(new_data$mode_delivery) == "5", 1, 0))
##Advanced age
new_data<-mutate(new_data, Advanced_age=ifelse(age>34,1,0))
##history of any medical illness
new_data$medical_illness<-ifelse(as.character(new_data$medical_illness)=="1", 1, 0)
##ANC visit
new_data$number_ANC_cat<-ifelse(as.character(new_data$number_ANC_cat)=="1", 1, 0)
## Abortion
new_data$abortion <-ifelse(as.character(new_data$abortion) == "1", 1, 0)
## IUFD
new_data$IUFD <-ifelse(as.character(new_data$IUFD) == "1", 1, 0)
## PRETERM
new_data$Preterm_d <-ifelse(as.character(new_data$Preterm_d) == "1", 1, 0)
## inst delivery
new_data$instrumental_d <-ifelse(as.character(new_data$instrumental_d) == "1", 1, 0)
## CS
new_data$C_S <-ifelse(as.character(new_data$C_S) == "1", 1, 0)
## ANC
new_data$ANC <-ifelse(as.character(new_data$ANC) == "2", 1, 0)
## previous mode del
new_data$mode_delivery_last <-ifelse(as.character(new_data$mode_delivery_last) == "2", 1, 0)
## PROM
new_data$PROM <-ifelse(as.character(new_data$PROM) == "1", 1, 0)
## HDP
new_data$HDP <-ifelse(as.character(new_data$HDP) == "1", 1, 0)
## Parity
new_data <- mutate(new_data, parity_cat= ifelse(parity > 4, 1,0))
table1(~ as.factor(Advanced_age) + as.factor(medical_illness) + as.factor(number_ANC_cat) + as.factor(abortion) + as.factor(IUFD) + as.factor(Preterm_d) + as.factor(C_S) + as.factor(ANC) + as.factor(mode_delivery_last) + as.factor(PROM) + as.factor(HDP) + as.factor(parity_cat) | as.factor(outcome), data= new_data)
library(gtsummary)
Table_1 <- new_data %>%
dplyr::select(participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall() %>%
as_flex_table()
Table_1 <- new_data %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall() %>%
as_flex_table()
Table_1 <- new_data %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
library(tidyselect)
library(tidyverse)
Table_1 <- new_data %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
library(gtsummary)
Table_1 <- new_data %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
## outcome
new_data <- mutate(new_data, outcome= ifelse(as.character(new_data$mode_delivery) == "5", 1, 0))
library(haven)
dat_cs <- read_sav("thesis_data_NB.sav")
str(dat_cs)
dat_cs <- dat_cs[-310, ]
new_data <- dat_cs %>%
dplyr::select(participant_id, age, gravidity, parity, abortion, IUFD, Preterm_d, instrumental_d, C_S, ANC, mode_delivery_last, DM, PROM, PTL, APH, HDP, mode_delivery,medical_illness,number_ANC_cat)
## outcome
new_data <- mutate(new_data, outcome= ifelse(as.character(new_data$mode_delivery) == "5", 1, 0))
##Advanced age
new_data<-mutate(new_data, Advanced_age=ifelse(age>34,1,0))
##history of any medical illness
new_data$medical_illness<-ifelse(as.character(new_data$medical_illness)=="1", 1, 0)
##ANC visit
new_data$number_ANC_cat<-ifelse(as.character(new_data$number_ANC_cat)=="1", 1, 0)
## Abortion
new_data$abortion <-ifelse(as.character(new_data$abortion) == "1", 1, 0)
## IUFD
new_data$IUFD <-ifelse(as.character(new_data$IUFD) == "1", 1, 0)
## PRETERM
new_data$Preterm_d <-ifelse(as.character(new_data$Preterm_d) == "1", 1, 0)
## inst delivery
new_data$instrumental_d <-ifelse(as.character(new_data$instrumental_d) == "1", 1, 0)
## CS
new_data$C_S <-ifelse(as.character(new_data$C_S) == "1", 1, 0)
## ANC
new_data$ANC <-ifelse(as.character(new_data$ANC) == "2", 1, 0)
## previous mode del
new_data$mode_delivery_last <-ifelse(as.character(new_data$mode_delivery_last) == "2", 1, 0)
## PROM
new_data$PROM <-ifelse(as.character(new_data$PROM) == "1", 1, 0)
## HDP
new_data$HDP <-ifelse(as.character(new_data$HDP) == "1", 1, 0)
## Parity
new_data <- mutate(new_data, parity_cat= ifelse(parity > 4, 1,0))
colSums(is.na(new_data))
table1(~ as.factor(Advanced_age) + as.factor(medical_illness) + as.factor(number_ANC_cat) + as.factor(abortion) + as.factor(IUFD) + as.factor(Preterm_d) + as.factor(C_S) + as.factor(ANC) + as.factor(mode_delivery_last) + as.factor(PROM) + as.factor(HDP) + as.factor(parity_cat) | as.factor(outcome), data= new_data)
library(table1)
table1(~ as.factor(Advanced_age) + as.factor(medical_illness) + as.factor(number_ANC_cat) + as.factor(abortion) + as.factor(IUFD) + as.factor(Preterm_d) + as.factor(C_S) + as.factor(ANC) + as.factor(mode_delivery_last) + as.factor(PROM) + as.factor(HDP) + as.factor(parity_cat) | as.factor(outcome), data= new_data)
Table_1 <- new_data %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
print(Table_1)
str(new_data$ANC)
new_data %>% mutate_at(c('HDP', 'PROM', 'Preterm_d', 'medical_illness', 'APH', 'abortion', 'number_ANC_cat', 'IUFD', 'ANC', 'mode_delivery_last', 'parity_cat'), as.factor)
new_data %>% mutate_at(c('Advanced_age', 'HDP', 'PROM', 'Preterm_d', 'medical_illness', 'APH', 'abortion', 'number_ANC_cat', 'IUFD', 'ANC', 'mode_delivery_last', 'parity_cat'), as.factor)
)
new_data1 <- new_data %>% select(Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat)
Table_1 <- new_data1 %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
new_data1 <- new_data %>% select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat)
Table_1 <- new_data1 %>%
dplyr::select(-participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
print(Table_1)
table(new_data$mode_delivery_last)
new_data %>% mutate_at(c('Advanced_age', 'HDP', 'PROM', 'Preterm_d', 'medical_illness', 'APH', 'abortion', 'number_ANC_cat', 'IUFD', 'ANC', 'mode_delivery_last', 'parity_cat', 'outcome'), as.factor)
new_data1 <- new_data %>% select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, outcome)
Table_1 <- new_data1 %>%
dplyr::select(- participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
print(Table_1)
table(new_data$APH)
#APH
new_data$APH <- ifelse(as.character(new_data$APH) == "1", 1,0)
new_data %>% mutate_at(c('Advanced_age', 'HDP', 'PROM', 'Preterm_d', 'medical_illness', 'APH', 'abortion', 'number_ANC_cat', 'IUFD', 'ANC', 'mode_delivery_last', 'parity_cat', 'APH', 'outcome'), as.factor)
new_data1 <- new_data %>% select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, APH, outcome)
Table_1 <- new_data1 %>%
dplyr::select(- participant_id) %>%
tbl_summary(by= outcome) %>%
add_overall()
print(Table_1)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP + APH, family= binomial, data = new_data)
summary(full_fit)
table1(~ as.factor(Advanced_age) + as.factor(medical_illness) + as.factor(number_ANC_cat) + as.factor(abortion) + as.factor(IUFD) + as.factor(Preterm_d) + as.factor(C_S) + as.factor(ANC) + as.factor(mode_delivery_last) + as.factor(PROM) + as.factor(HDP) + as.factor(parity_cat) + as.factor(APH) | as.factor(outcome), data= new_data)
stepAIC(full_fit)
library(MASS)
stepAIC(full_fit)
red_model <- full_fit <- glm(outcome~  HDP + mode_delivery_last, family= binomial, data = new_data)
## ORs and CIs
OR_CI <- exp(cbind(OR= coef(red_model), confint(red_model)))
round(OR_CI, digits = 3)
red_model <- full_fit <- glm(outcome~  HDP + APH + mode_delivery_last, family= binomial, data = new_data)
## ORs and CIs
OR_CI <- exp(cbind(OR= coef(red_model), confint(red_model)))
round(OR_CI, digits = 3)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP + APH, family= binomial, data = new_data)
## OR for full model
OR_full <- exp(cbind(OR= coef(full_fit), confint(full_fit)))
round(OR_full, digits = 3)
View(dat_cs)
table1(~ residence, data= dat_cs)
table1(~ as.factor(residence), data= dat_cs)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP + APH + as.factor(residence), family= binomial, data = new_data)
summary(full_fit)
new_data <- dat_cs %>%
dplyr::select(participant_id, age, gravidity, parity, abortion, IUFD, Preterm_d, instrumental_d, C_S, ANC, mode_delivery_last, DM, PROM, PTL, APH, HDP, mode_delivery,medical_illness,number_ANC_cat, residence)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP + APH + as.factor(residence), family= binomial, data = new_data)
## outcome
new_data <- mutate(new_data, outcome= ifelse(as.character(new_data$mode_delivery) == "5", 1, 0))
##Advanced age
new_data<-mutate(new_data, Advanced_age=ifelse(age>34,1,0))
##history of any medical illness
new_data$medical_illness<-ifelse(as.character(new_data$medical_illness)=="1", 1, 0)
##ANC visit
new_data$number_ANC_cat<-ifelse(as.character(new_data$number_ANC_cat)=="1", 1, 0)
## Abortion
new_data$abortion <-ifelse(as.character(new_data$abortion) == "1", 1, 0)
## IUFD
new_data$IUFD <-ifelse(as.character(new_data$IUFD) == "1", 1, 0)
## PRETERM
new_data$Preterm_d <-ifelse(as.character(new_data$Preterm_d) == "1", 1, 0)
## inst delivery
new_data$instrumental_d <-ifelse(as.character(new_data$instrumental_d) == "1", 1, 0)
## CS
new_data$C_S <-ifelse(as.character(new_data$C_S) == "1", 1, 0)
## ANC
new_data$ANC <-ifelse(as.character(new_data$ANC) == "2", 1, 0)
## previous mode del
new_data$mode_delivery_last <-ifelse(as.character(new_data$mode_delivery_last) == "2", 1, 0)
## PROM
new_data$PROM <-ifelse(as.character(new_data$PROM) == "1", 1, 0)
## HDP
new_data$HDP <-ifelse(as.character(new_data$HDP) == "1", 1, 0)
## Parity
new_data <- mutate(new_data, parity_cat= ifelse(parity > 4, 1,0))
#APH
new_data$APH <- ifelse(as.character(new_data$APH) == "1", 1,0)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP + APH + as.factor(residence), family= binomial, data = new_data)
summary(full_fit)
## OR for full model
OR_full <- exp(cbind(OR= coef(full_fit), confint(full_fit)))
round(OR_full, digits = 3)
stepAIC(full_fit)
red_model <- full_fit <- glm(outcome~  HDP + APH + mode_delivery_last, family= binomial, data = new_data)
## ORs and CIs
OR_CI <- exp(cbind(OR= coef(red_model), confint(red_model)))
round(OR_CI, digits = 3)
full_fit <- glm(outcome~ Advanced_age + abortion + parity_cat + mode_delivery_last + number_ANC_cat + medical_illness + HDP + APH, family= binomial, data = new_data)
summary(full_fit)
## OR for full model
OR_full <- exp(cbind(OR= coef(full_fit), confint(full_fit)))
round(OR_full, digits = 3)
library(boot)
library(pROC)
# Step 2: Define your prognostic model
## Assuming you want to build a logistic regression model
model <- glm(outcome ~ HDP + APH + mode_delivery_last, family = binomial, data = new_data)
View(full_fit)
return(pROC::auc(pROC::roc(observed, predicted)))
# Step 3: Define a function to compute the AUC
auc <- function(new_data, indices) {
d <- new_data[indices, ]
model_fit <- glm(outcome ~ HDP + mode_delivery_last, family = binomial, data = d)
predicted <- predict(model_fit, newdata = d, type = "response")
observed <- d$
return(pROC::auc(pROC::roc(observed, predicted)))
}
# load packages
library(boot)
library(pROC)
# Step 2: Define your prognostic model
## Assuming you want to build a logistic regression model
model <- glm(outcome ~ HDP + APH + mode_delivery_last, family = binomial, data = new_data)
# Step 3: Define a function to compute the AUC
auc <- function(new_data, indices) {
d <- new_data[indices, ]
model_fit <- glm(outcome ~ HDP + mode_delivery_last, family = binomial, data = d)
predicted <- predict(model_fit, newdata = d, type = "response")
observed <- d$outcome
return(pROC::auc(pROC::roc(observed, predicted)))
}
# Step 4: Perform bootstrap resampling
boot_results <- boot(data = new_data, statistic = auc, R = 100)
# Step 5: Extract the AUC values for each bootstrap sample
boot_auc <- boot_results$t
print(boot_auc)
mean(boot_auc)
# load packages
library(boot)
library(pROC)
# Step 2: Define your prognostic model
## Assuming you want to build a logistic regression model
model <- glm(outcome ~ HDP + APH + mode_delivery_last, family = binomial, data = new_data)
# Step 3: Define a function to compute the AUC
auc <- function(new_data, indices) {
d <- new_data[indices, ]
model_fit <- glm(outcome ~ HDP + mode_delivery_last, family = binomial, data = d)
predicted <- predict(model_fit, newdata = d, type = "response")
observed <- d$outcome
return(pROC::auc(pROC::roc(observed, predicted)))
}
# Step 4: Perform bootstrap resampling
boot_results <- boot(data = new_data, statistic = auc, R = 10000)
# Step 5: Extract the AUC values for each bootstrap sample
boot_auc <- boot_results$t
print(boot_auc)
mean(boot_auc)
# load packages
library(boot)
library(pROC)
# Step 2: Define your prognostic model
## Assuming you want to build a logistic regression model
model <- glm(outcome ~ HDP + APH + mode_delivery_last, family = binomial, data = new_data)
# Step 3: Define a function to compute the AUC
auc <- function(new_data, indices) {
d <- new_data[indices, ]
model_fit <- glm(outcome ~ HDP + mode_delivery_last, family = binomial, data = d)
predicted <- predict(model_fit, newdata = d, type = "response")
observed <- d$outcome
return(pROC::auc(pROC::roc(observed, predicted)))
}
# Step 4: Perform bootstrap resampling
boot_results <- boot(data = new_data, statistic = auc, R = 1000)
# Step 5: Extract the AUC values for each bootstrap sample
boot_auc <- boot_results$t
print(boot_auc)
mean(boot_auc)
predicted_probabilities <- predict(red_model, type = "response")
calibration_data <- data.frame(Outcome = new_data$outcome, Predicted_Risks = predicted_probabilities)
predRisk <- predRisk(red_model)
library(PredictABEL)
predicted_probabilities <- predict(red_model, type = "response")
calibration_data <- data.frame(Outcome = new_data$outcome, Predicted_Risks = predicted_probabilities)
predRisk <- predRisk(red_model)
plotCalibration(calibration_data, 1, predRisk, 10,plottitle = "Calibration_of_the_model")
predsred = predict(red_model,type="response")
plot.roc(new_data$outcome, predsred,print.auc=TRUE)
apparent_performance <- 0.777
true_perf <- mean(boot_auc)  # mean of the bootstrap sample
over_opt_coef <- (apparent_performance - true_perf) / apparent_performance
new_data$APH_rs <- as.numeric(new_data$APH)
stepAIC(full_fit)
new_data$Risk_score<-(1*new_data$HDP_rs)+(3*new_data$mode_delivery_last_rs) + (2*new_data$APH_rs)
new_data$HDP_rs<-as.numeric(new_data$HDP)
new_data$mode_delivery_last_rs<-as.numeric(new_data$mode_delivery_last)
new_data$APH_rs <- as.numeric(new_data$APH)
new_data$Risk_score<-(1*new_data$HDP_rs)+(3*new_data$mode_delivery_last_rs) + (2*new_data$APH_rs)
cor.test(new_data$outcome,new_data$Risk_score)
risk<-glm(new_data$outcome~new_data$Risk_score,family = binomial)
predsrisk = predict(risk,type="response")
plot.roc(new_data$outcome, predsrisk,print.auc=TRUE)
risk<-glm(new_data$outcome~new_data$Risk_score,family = binomial)
predsrisk = predict(risk,type="response")
plot.roc(new_data$outcome, predsrisk,print.auc=TRUE)
table(new_data$Risk_score)
View(new_data)
length(new_data$participant_id[new_data$Risk_score=="0" & new_data$outcome=="1"])/ length(new_data$participant_id[new_data$Risk_score=="0"])
length(new_data$participant_id[new_data$Risk_score=="1" & new_data$outcome=="1"])/ length(new_data$participant_id[new_data$Risk_score=="1"])
length(new_data$participant_id[new_data$Risk_score=="2" & new_data$outcome=="1"])/ length(new_data$participant_id[new_data$Risk_score=="2"]) # risk 0.15
length(new_data$participant_id[new_data$Risk_score=="3" & new_data$outcome=="1"])/ length(new_data$participant_id[new_data$Risk_score=="3"]) # risk 0.15
length(new_data$participant_id[new_data$Risk_score=="4" & new_data$outcome=="1"])/ length(new_data$participant_id[new_data$Risk_score=="4"]) # risk 0.15
length(new_data$participant_id[new_data$Risk_score=="5" & new_data$outcome=="1"])/ length(new_data$participant_id[new_data$Risk_score=="5"]) # risk 0.15
library(dcurves)
library(rmda)
Dcred<-decision_curve(outcome~  HDP + APH + mode_delivery_last, family= binomial, data = new_data,thresholds = seq(0, 1, by = .01),confidence.intervals = 0.95)
# Define the colors for each line
line.colors <- c("blue", "green","red")
plot_decision_curve(x=Dcred, curve.names=c("Model", "Intervention for all", "Intervention for none"), cost.benefit.axis = TRUE,col = line.colors)
install.packages("rms")
library(rms)
##Creating new dataset
newdata_nomogram<-new_data  %>%
dplyr::select(outcome,HDP_rs,mode_delivery_last_rs,APH_rs)
#Changing the variables to the form that we want to see in the chart
newdata_nomogram$HDP <-factor(newdata_nomogram$HDP_rs,levels = c(0, 1), labels = c("No","Yes"))
newdata_nomogram$Last_delivery <-factor(newdata_nomogram$mode_delivery_last_rs, levels = c(0, 1), labels= c("Vaginal","Cesarean"))
newdata_nomogram$APH <- factor(newdata_nomogram$APH_rs,levels = c(0, 1), labels= c("No","Yes"))
# Fit model
model.rms <- lrm(outcome ~ HDP_rs,mode_delivery_last_rs,APH_rs, data = newdata_nomogram)
# Fit model
model.rms <- lrm(outcome ~ HDP,Last_delivery,APH, data = newdata_nomogram)
?lrm
# Fit model
model.rms <- lrm(outcome ~ HDP,Last_delivery,APH, data = newdata_nomogram, na.action=na.delete, method="lrm.fit")
# Fit model
model.rms <- lrm(outcome ~ HDP_rs,mode_delivery_last_rs,APH_rs, data = newdata_nomogram, na.action=na.delete, method="lrm.fit")
newdata_nomogram$HDP <-factor(newdata_nomogram$HDP_rs,levels = c(0, 1), labels = c("No","Yes"))
newdata_nomogram$Last_delivery <-factor(newdata_nomogram$mode_delivery_last_rs, levels = c(0, 1), labels= c("Vaginal","Cesarean"))
newdata_nomogram$APH <- factor(newdata_nomogram$APH_rs,levels = c(0, 1), labels= c("No","Yes"))
# Fit model
model.rms <- lrm(outcome ~ HDP_rs,mode_delivery_last_rs,APH_rs, data = newdata_nomogram, na.action=na.delete, method="lrm.fit")
model.rms
##Creating new dataset
newdata_nomogram<-new_data  %>%
dplyr::select(outcome,HDP_rs,mode_delivery_last_rs,APH_rs)
#Changing the variables to the form that we want to see in the chart
newdata_nomogram$HDP <-factor(newdata_nomogram$HDP_rs,levels = c(0, 1), labels = c("No","Yes"))
newdata_nomogram$Last_delivery <-factor(newdata_nomogram$mode_delivery_last_rs, levels = c(0, 1), labels= c("Vaginal","Cesarean"))
newdata_nomogram$APH <- factor(newdata_nomogram$APH_rs,levels = c(0, 1), labels= c("No","Yes"))
# Fit model
model.rms <- lrm(outcome ~ HDP_rs,mode_delivery_last_rs,APH_rs, data = newdata_nomogram, na.action=na.delete, method="lrm.fit")
model.rms
table(new_data$APH_rs)
View(newdata_nomogram)
write.csv(newdata_nomogram, "nomogram.csv")
# Fit model
model.rms <- lrm(outcome ~ HDP_rs,mode_delivery_last_rs,APH_rs, data = newdata_nomogram, na.action=na.delete, method="lrm.fit")
model.rms
# Fit model
model.rms <- lrm(outcome ~ HDP_rs,mode_delivery_last_rs,APH_rs, data = newdata_nomogram, na.action=na.delete, method="lrm.fit")
##Creating new dataset
newdata_nomogram<-new_data  %>%
dplyr::select(outcome,HDP_rs,mode_delivery_last_rs,APH_rs)
#Changing the variables to the form that we want to see in the chart
newdata_nomogram$HDP <-factor(newdata_nomogram$HDP_rs,levels = c(0, 1), labels = c("No","Yes"))
newdata_nomogram$Last_delivery <-factor(newdata_nomogram$mode_delivery_last_rs, levels = c(0, 1), labels= c("Vaginal","Cesarean"))
newdata_nomogram$APH <- factor(newdata_nomogram$APH_rs,levels = c(0, 1), labels= c("No","Yes"))
# Fit model
model.rms <- lrm(outcome ~ HDP + Last_delivery + APH, data = newdata_nomogram)
model.rms
# plot the nomogram
par(mar = c(5, 5, 4, 2) + 0.1)  # Adjust the margin sizes as needed
ddist <- datadist(nomogram)
options(datadist = "ddist")
plot(nomogram(model.rms, fun = plogis, funlabel = "Risk of CS among parous women"))
ddist <- datadist(nomogram)
str(nomogram)
ddist <- datadist(model.rms)
nomogram <- nomogram(model.rms)
ddist <- datadist(model.rms)
ddist <- datadist(nomogram)
nomogram <- nomogram(model.rms)
data_nomogram <- datadist(newdata_nomogram)
options(datadist = 'data_nomogram')
nomogram <- nomogram(model.rms)
ddist <- datadist(nomogram)
plot(nomogram(model.rms, fun = plogis, funlabel = "Risk of CS among parous women"))
plot(nomogram(model.rms, fun = plogis, funlabel = "Risk of CS among parous women"))
# plot the nomogram
par(mar = c(5, 5, 4, 2) + 0.1)  # Adjust the margin sizes as needed
data_nomogram <- datadist(newdata_nomogram) # define data distribution
options(datadist = 'data_nomogram')
nomogram <- nomogram(model.rms)
plot(nomogram(model.rms, fun = plogis, funlabel = "Risk of CS among parous women"))
detach("package:table1", unload = TRUE)
library(table1)
new_data1 <- new_data %>%
select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, APH, outcome)
new_data %>% mutate_at(c('Advanced_age', 'HDP', 'PROM', 'Preterm_d', 'medical_illness', 'APH', 'abortion', 'number_ANC_cat', 'IUFD', 'ANC', 'mode_delivery_last', 'parity_cat', 'APH', 'outcome'), as.factor)
new_data1 <- new_data %>%
select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, APH, outcome)
new_data1 <- new_data %>%
select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, APH, outcome)
new_data1 <- new_data %>%
select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, outcome)
new_data1 <- new_data %>%
select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, outcome)
new_data %>% mutate_at(c('Advanced_age', 'HDP', 'PROM', 'Preterm_d', 'medical_illness', 'APH', 'abortion', 'number_ANC_cat', 'IUFD', 'ANC', 'mode_delivery_last', 'parity_cat', 'outcome'), as.factor)
new_data1 <- new_data %>%
select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, outcome)
new_data1 <- new_data %>%
dplyr::select(participant_id, Advanced_age, HDP, PROM, Preterm_d, medical_illness, APH, abortion, number_ANC_cat, IUFD, ANC, mode_delivery_last, parity_cat, outcome)
